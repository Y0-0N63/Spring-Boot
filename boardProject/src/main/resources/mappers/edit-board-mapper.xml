<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- namespace에 연결할 Mapper 인터페이스의 패키지명.인터페이스명 작성
	> Mapper 인터페이스에 있는 메서드 호출 시, 해당 xml 파일에 작성된 태그 중 메서드명과 동일한 id를 가진 sql 수행  -->
<mapper namespace="edu.kh.project.board.model.mapper.EditBoardMapper">

	<!-- useGeneratedKeys 속성 : DB 내부적으로 생성한 키(ex_시퀀스)를 전달된 파라미터의 필드로 대입 가능한지 여부를 지정해주는 속성
		<selectKey> 태그 : INSERT/UPDATE 시 사용할 키(시퀀스)를 조회해서 파라미터의 지정된 필드에 대입하는 역할의 태그
		order 속성 : main SQL이 수행되기 전(BEFORE) or 후(AFTER)에 selectKey가 수행되도록 지정
		keyProperty 속성 : selectKey 조회 결과를 저장할 파라미터의 필드명 -->
	<insert id="boardInsert" useGeneratedKeys="true" parameterType="Board">
		<selectKey order="BEFORE" resultType="_int" keyProperty="boardNo">
			SELECT SEQ_BOARD_NO.NEXTVAL FROM DUAL
		</selectKey>
		
		<!-- 
 		동적 SQL 중 <foreach>
 		- Mybatis에서 제공하는 향상된 for문
 		
 		- 특정 SQL 구문을 반복할 때 사용
 		
 		- 반복 사이에 구분자(separator)를 추가할 수 있음
 		
 		[지원하는 속성]
 		collection : 반복할 객체의 타입 작성(list, set, map...)
		item : collection에서 순차적으로 꺼낸 하나의 요소를 저장하는 변수
		index : 현재 반복 접근중인 인덱스 (0,1,2,3,4 ..)
		
		open : 반복 전에 출력할 sql
		close : 반복 종료 후에 출력한 sql
		
		separator : 반복 사이사이 구분자
 	-->
		INSERT INTO "BOARD"
		VALUES(#{boardNo}, #{boardTitle}, #{boardContent}, DEFAULT, DEFAULT, DEFAULT, DEFAULT, #{boardCode}, #{memberNo})
	</insert>
	
	<insert id="insertUploadList" parameterType="List">
		INSERT INTO "BOARD_IMG"
		<foreach collection="list" item="img" open="(" close= ")" separator=" UNION ">
			SELECT NEXT_IMG_NO(),
			#{img.imgPath},
			#{img.imgOriginalName},
			#{img.imgRename},
			#{img.imgOrder},
			#{img.boardNo}
			FROM DUAL
		</foreach>
	</insert>
</mapper>